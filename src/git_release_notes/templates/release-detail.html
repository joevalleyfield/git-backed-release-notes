<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Release {{ release["slug"] }}</title>
  {% set use_local_assets = handler.settings.get("use_local_assets") %}
  {% if use_local_assets %}
  <link rel="stylesheet" href="{{ static_url('vendor/bootstrap-5.3.7.min.css') }}">
  <script src="{{ static_url('vendor/bootstrap-5.3.7.bundle.min.js') }}"></script>
  {% else %}
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
    integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr sha384-fhoKacxXiUKwMGMcI8QlD1sG38/zqnIgQmAQr0Nu+cv25q8Q348nzcZEzXm0/gau"
    crossorigin="anonymous"
  >
  <link rel="stylesheet" href="{{ static_url('vendor/bootstrap-5.3.7.min.css') }}">
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q sha384-H+d/9ZcoyMusVG6bhHlOvRrcmhyEoGxj4f5Vt209iGhHV828YDm+Mk6/36f2JYWM"
    crossorigin="anonymous"
  ></script>
  <script>
    if (typeof bootstrap === "undefined") {
      document.write('<script src="{{ static_url("vendor/bootstrap-5.3.7.bundle.min.js") }}"><\\/script>');
    }
  </script>
  {% end %}
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="/" data-test="nav-commits">Commits</a>
      <div class="navbar-nav">
        <a class="nav-link" href="/issues" data-test="nav-issues">Issues</a>
        <a class="nav-link active fw-semibold" href="/releases" data-test="nav-releases" aria-current="page">Releases</a>
      </div>
    </div>
  </nav>

  <main class="container my-4">
    <header class="mb-4">
      <p class="text-muted mb-1">Release</p>
      <h1 class="h3 mb-0" data-test="release-heading">{{ release["slug"] }}</h1>
      <p class="text-muted" data-test="release-summary">{{ summary["text"] }}</p>
      {% if summary["latest_commit"] %}
      <p class="text-muted small mb-0">
        Latest commit: {{ summary["latest_commit"] }}{% if summary["earliest_commit"] and summary["earliest_commit"] != summary["latest_commit"] %} · Earliest commit: {{ summary["earliest_commit"] }}{% end %}
      </p>
      {% end %}
      {% if tag_metadata %}
      <p class="text-muted small mb-0" data-test="release-tag-metadata">
        {% if tag_metadata["direct"] %}
          Tag <code>{{ tag_metadata["tag"] }}</code> points at commit <code>{{ tag_metadata["short_sha"] }}</code>.
        {% else %}
          {% if tag_metadata["previous"] %}
            Previous tag <code>{{ tag_metadata["previous"] }}</code>
            {% if tag_metadata["previous_count"] is not None %}
              ({{ tag_metadata["previous_count"] }} commits back)
            {% end %}
          {% end %}
          {% if tag_metadata["previous"] and tag_metadata["next"] %} · {% end %}
          {% if tag_metadata["next"] %}
            Next tag <code>{{ tag_metadata["next"] }}</code>.
          {% end %}
        {% end %}
      </p>
      {% end %}
    </header>

    <section class="mb-5">
      <h2 class="h5">Issues</h2>
      {% if not issues %}
        <p class="text-muted" data-test="release-no-issues">No issues linked to this release yet.</p>
      {% else %}
        <div class="list-group">
          {% for issue in issues %}
          <article class="list-group-item" data-test="release-issue" data-slug="{{ issue.slug }}">
            <header class="d-flex align-items-center justify-content-between">
              <h3 class="h5 mb-0">
                <a class="link-underline link-underline-opacity-0" data-test="release-issue-link" href="/issue/{{ issue.slug }}">
                  {{ issue.title or issue.slug }}
                </a>
              </h3>
              <span class="badge text-bg-secondary" data-test="release-issue-status">
                {{ issue.status or "unknown" }}
              </span>
            </header>
            <p class="mb-0 text-muted small">{{ issue.slug }}</p>
          </article>
          {% end %}
        </div>
      {% end %}
    </section>

    <section>
      <h2 class="h5">Commits</h2>
      {% if not commits %}
        <p class="text-muted" data-test="release-no-commits">No commits have been linked to this release.</p>
      {% else %}
        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead class="table-light">
              <tr>
                <th scope="col">SHA</th>
                <th scope="col">Summary</th>
                <th scope="col">Date</th>
                <th scope="col">Issue</th>
              </tr>
            </thead>
            <tbody>
              {% for commit in commits %}
              <tr data-test="release-commit" data-sha="{{ commit.short_sha }}">
                <td>
                  <a data-test="release-commit-link" href="/commit/{{ commit.sha }}">
                    <code>{{ commit.short_sha }}</code>
                  </a>
                </td>
                <td>{{ commit.subject }}</td>
                <td class="text-nowrap">{{ commit.author_date }}</td>
                <td>{{ commit.issue }}</td>
              </tr>
              {% end %}
            </tbody>
          </table>
        </div>
      {% end %}
    </section>
  </main>
</body>
</html>
