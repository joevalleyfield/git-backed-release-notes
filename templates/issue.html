<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Issue: {{ slug }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.3/dist/purify.min.js"></script>
</head>
<body>
  <main class="container py-4">
    <header class="mb-4">
      <h1 class="h4">Issue: {{ slug }}</h1>
      <p><strong>Status:</strong> {{ status }}</p>
    </header>

    <form action="/issue/{{ slug }}/update" method="post" class="mb-4">
      <ul class="nav nav-tabs mb-2" id="editorTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="edit-tab" data-bs-toggle="tab" data-bs-target="#edit" type="button" role="tab">Edit</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="preview-tab" data-bs-toggle="tab" data-bs-target="#preview" type="button" role="tab">Preview</button>
        </li>
        <!-- Future: <li class="nav-item"><button class="nav-link" ...>WYSIWYG</button></li> -->
      </ul>

      <div class="tab-content border rounded p-3" id="editorTabsContent">
        <div class="tab-pane fade show active" id="edit" role="tabpanel">
          <textarea name="markdown" id="markdown" class="form-control" rows="20" style="font-family: monospace;">{{ content }}</textarea>
        </div>
        <div class="tab-pane fade" id="preview" role="tabpanel">
          <div id="preview-content" class="markdown-body"></div>
        </div>
      </div>

      <div class="mt-3">
        <button type="submit" class="btn btn-primary">Save</button>
      </div>
    </form>

    {% if linked_commits %}
      <section>
        <h2 class="h5">Linked Commits</h2>
        <ul class="list-group">
          {% for sha in linked_commits %}
            <li class="list-group-item"><a href="/commit/{{ sha }}">{{ sha }}</a></li>
          {% end %}
        </ul>
      </section>
    {% end %}
  </main>

  <script>
    const textarea = document.getElementById('markdown');
    const preview = document.getElementById('preview-content');

    document.getElementById('preview-tab').addEventListener('shown.bs.tab', () => {
      const raw = textarea.value;
      preview.innerHTML = DOMPurify.sanitize(marked.parse(raw));
    });
  </script>
</body>
</html>
