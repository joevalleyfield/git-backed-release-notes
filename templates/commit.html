<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Commit {{ sha }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>

  <!-- diff2html CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"></script>
</head>
<body>
  <main class="container py-4">

    <header class="mb-3">
      <h1 class="h4">git show {{ sha }}</h1>

      {% if parents or children %}
        <nav class="small mb-2">
          {% if parents %}
            <strong>Parents:</strong><br>
            {% for p in parents %}
              <a href="/commit/{{ p }}">{{ p[:7] }}</a><br>
            {% end %}
          {% end %}
          {% if children %}
            <strong>Children:</strong><br>
            {% for c in children %}
              <a href="/commit/{{ c }}">{{ c[:7] }}</a><br>
            {% end %}
          {% end %}
        </nav>
      {% end %}

      {% if describe_name %}
        <p class="text-muted"><em> {{describe_name}} </em></p>
      {% end %}

      {% if follows or precedes %}
        <nav class="small mb-2">
          {% if follows and follows.count > 0 %}
            <strong>Follows:</strong>
            {{ follows.base_tag }}
            (<a href="/commit/{{ follows.tag_sha }}">{{ follows.tag_sha[:7] }}</a>)<br>
          {% end %}
          {% if precedes %}
            <strong>Precedes:</strong>
            {{ precedes.base_tag }}
            (<a href="/commit/{{ precedes.tag_sha }}">{{ precedes.tag_sha[:7] }}</a>)
          {% end %}
        </nav>
      {% end %}
    </header>

    <section class="mb-4" aria-labelledby="commit-form-title">
      <h2 id="commit-form-title" class="h5 mb-3">Edit Metadata</h2>
      <form action="/commit/{{ commit['sha'] }}/update" method="post">
        <div class="mb-3">
          <label for="issue" class="form-label">Issue</label>
          <input type="text" class="form-control" name="issue" id="issue" value="{{ commit['issue'] }}">
        </div>
        <div class="mb-3">
          <label for="release" class="form-label">Release</label>
          <input type="text" class="form-control" name="release" id="release" value="{{ commit['release'] }}">
        </div>
        <button type="submit" class="btn btn-primary">Update</button>
      </form>
    </section>

    <section class="mb-4" aria-labelledby="commit-header-title">
      <h2 id="commit-header-title" class="visually-hidden">Commit Header</h2>
      <pre class="bg-light p-3 border rounded">{{ output_header }}</pre>
    </section>

    {% if linked_issues %}
    <div>
      Related Issues:
      {% for slug in linked_issues %}
      <a href="/issue/{{ slug }}">{{ slug }}</a>
      {% end %}
    </div>
    {% end %}

    <section class="mb-4" aria-labelledby="commit-diff-title">
      <h2 id="commit-diff-title" class="visually-hidden">Diff</h2>
      <div id="diff" class="border rounded">
        <pre class="bg-light p-3 m-0">{{ output_diff }}</pre>
      </div>
      <script>
        const container = document.getElementById("diff");
        const rawText = container.textContent;
        const ui = new Diff2HtmlUI(container, rawText, {
          drawFileList: true,
          outputFormat: "line-by-line",
          matching: "lines",
        });
        ui.draw();
      </script>
    </section>

    <footer class="mt-4">
      <a id="back-link" class="btn btn-outline-secondary" href="/#sha-{{ sha[:7] }}">‚Üê Back to index</a>
    </footer>

  </main>
</body>
</html>
